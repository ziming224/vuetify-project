import{ad as q,W as B,v as L,c as _,af as v,_ as t,ak as V,ae as N,X as P,Z as l,F as e,E as k,Y as y,I as b,a0 as T,ag as D,ah as u,aj as d,aP as U,V as E,ai as F}from"./index-BnytfeGo.js";import{o as R}from"./order-BxSCi70G.js";import{V as $,a as i,b as h}from"./route-block-DENcxyka.js";import{V as j}from"./VContainer-_aepzmO1.js";import{V as C}from"./VDivider-LPd1PCe4.js";import{V as A,a as W,b as X,c as Y}from"./VList-CpEARpmD.js";import{V as Z}from"./VNumberInput-B8wWruvo.js";import"./ssrBoot-64Mr1rQQ.js";const z={__name:"cart",setup(G){const c=q(),p=B(),x=N(),s=L([]);(async()=>{try{const{data:a}=await V.getCart();s.value=a.result}catch(a){console.error(a),c({text:"無法獲取購物車資料",snackbarProps:{color:"red"}})}})();const g=async(a,o,n)=>{try{const{data:r}=await V.cart({product:o.product._id,quantity:a-o.quantity});o.quantity=a,a<=0&&s.value.splice(n,1),p.cartTotal=r.result}catch(r){console.error(r),c({text:"更新購物車失敗",snackbarProps:{color:"red"}})}},w=_(()=>s.value.reduce((a,o)=>a+o.product.price*o.quantity,0)),I=_(()=>s.value.length===0||s.value.some(a=>!a.product.sell)),S=async()=>{try{await R.create(),p.cartTotal=0,x.push("/orders")}catch{console.error(error),c({text:"結帳失敗",snackbarProps:{color:"red"}})}};return(a,o)=>{const n=P("router-link");return l(),v(j,null,{default:t(()=>[e($,null,{default:t(()=>[e(i,{cols:"12"},{default:t(()=>o[0]||(o[0]=[k("h1",{class:"text-center"},"購物車",-1)])),_:1,__:[0]}),e(C),e(i,{cols:"12"},{default:t(()=>[e(A,{lines:"two"},{default:t(()=>[(l(!0),y(b,null,T(s.value,(r,f)=>(l(),y(b,{key:r._id},[e(W,{active:!r.product.sell,color:"red"},{prepend:t(()=>[e(U,{class:"cursor-pointer",rounded:"0",onClick:m=>a.$router.push("/product/"+r.product._id)},{default:t(()=>[e(E,{src:r.product.image},null,8,["src"])]),_:2},1032,["onClick"])]),append:t(()=>[e(Z,{"control-variant":"split","hide-details":"",min:0,"model-value":r.quantity,variant:"outlined",width:"150px","onUpdate:modelValue":m=>g(m,r,f)},null,8,["model-value","onUpdate:modelValue"])]),default:t(()=>[e(X,null,{default:t(()=>[e(n,{class:"text-decoration-none text-white",to:"/product/"+r.product._id},{default:t(()=>[u(d(r.product.name),1)]),_:2},1032,["to"])]),_:2},1024),e(Y,null,{default:t(()=>[u(" 價格: "+d(r.product.price)+" 元 ",1)]),_:2},1024)]),_:2},1032,["active"]),f<s.value.length-1?(l(),v(C,{key:0})):D("",!0)],64))),128))]),_:1})]),_:1}),e(i,{class:"text-center",cols:"12"},{default:t(()=>[k("p",null,"總金額: "+d(w.value),1),e(F,{color:"primary",disabled:I.value,onClick:S},{default:t(()=>o[1]||(o[1]=[u("結帳")])),_:1,__:[1]},8,["disabled"])]),_:1})]),_:1})]),_:1})}}};typeof h=="function"&&h(z);export{z as default};
